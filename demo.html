<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified Feed Prototype (TikTok-Style)</title>
    <style>
        :root {
            color-scheme: light;
            --bg: #0b0b0f;
            --card: #11131a;
            --text: #f5f5f7;
            --muted: #c2c7d0;
            --accent: #ff3b7c;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            color: var(--text);
        }

        .feed-container {
            width: 100%;
            max-width: 560px;
            height: 100vh;
            overflow-y: auto;
            scroll-snap-type: y mandatory;
        }

        .post-card {
            position: relative;
            min-height: 100vh;
            background: var(--card);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            scroll-snap-align: start;
            padding: 24px 20px 80px;
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, #5563ff, #1bd5ff);
            border-radius: 50%;
        }

        .username {
            font-weight: 600;
            font-size: 15px;
        }

        .timestamp {
            font-size: 12px;
            color: var(--muted);
        }

        .post-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 0;
        }

        .placeholder-video {
            width: 100%;
            height: 60vh;
            border-radius: 16px;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .placeholder-image {
            width: 100%;
            height: 60vh;
            border-radius: 16px;
            background: linear-gradient(135deg, #5258ff, #ff5f6d);
        }

        .text-only {
            width: 100%;
            font-size: 18px;
            line-height: 1.6;
            color: var(--text);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
        }

        .post-footer {
            display: flex;
            flex-direction: column;
            gap: 10px;
            font-size: 14px;
            color: var(--muted);
        }

        .action-rail {
            position: absolute;
            right: 16px;
            bottom: 110px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
        }

        .btn {
            border: none;
            background: rgba(255, 255, 255, 0.08);
            color: var(--text);
            font-weight: 600;
            padding: 10px 12px;
            border-radius: 999px;
            cursor: pointer;
            min-width: 52px;
        }

        .btn.small {
            font-size: 12px;
            padding: 8px 10px;
        }

        .btn.liked {
            background: var(--accent);
        }

        .link-tag {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #9dd4ff;
            text-decoration: none;
        }

        #debug-console {
            position: fixed;
            bottom: 16px;
            left: 16px;
            width: 340px;
            height: 220px;
            background: rgba(0, 0, 0, 0.85);
            color: #7dff7a;
            font-family: monospace;
            font-size: 11px;
            padding: 12px;
            overflow-y: auto;
            border-radius: 8px;
            z-index: 999;
        }
    </style>
</head>
<body>
<div class="feed-container">
    <section class="post-card" id="post_0001" data-type="video" data-url="https://example.com/posts/0001">
        <div class="post-header">
            <div class="avatar"></div>
            <div>
                <div class="username">Research Project</div>
                <div class="timestamp">Just now ¬∑ Video</div>
            </div>
        </div>
        <div class="post-content">
            <div class="placeholder-video" onclick="toggleVideo(this, 'post_0001')">‚ñ∂ Tap to play demo video</div>
        </div>
        <div class="post-footer">
            <div>Prototype: track play, pause, dwell time, and engagement actions.</div>
            <a class="link-tag" href="https://example.com/posts/0001" onclick="trackEmbedLink('post_0001')">
                üîó example.com/posts/0001
            </a>
        </div>
        <div class="action-rail">
            <button class="btn" onclick="toggleLike(this, 'post_0001')">‚ô°</button>
            <button class="btn" onclick="trackComment('post_0001')">üí¨</button>
            <button class="btn" onclick="trackRepost('post_0001')">üîÅ</button>
            <button class="btn" onclick="toggleBookmark(this, 'post_0001')">üîñ</button>
        </div>
    </section>

    <section class="post-card" id="post_0002" data-type="text" data-url="https://example.com/posts/0002">
        <div class="post-header">
            <div class="avatar"></div>
            <div>
                <div class="username">User Study</div>
                <div class="timestamp">2 hrs ago ¬∑ Text</div>
            </div>
        </div>
        <div class="post-content">
            <div class="text-only">
                This is a text-only entry, like an X/Twitter or LinkedIn update. We track dwell time
                and any actions such as like, comment, repost, or bookmark. The content can be replaced
                with your real research posts (1,000‚Äì1,500 total entries).
            </div>
        </div>
        <div class="post-footer">
            <div>Tracking: dwell time + engagement actions.</div>
        </div>
        <div class="action-rail">
            <button class="btn" onclick="toggleLike(this, 'post_0002')">‚ô°</button>
            <button class="btn" onclick="trackComment('post_0002')">üí¨</button>
            <button class="btn" onclick="trackRepost('post_0002')">üîÅ</button>
            <button class="btn" onclick="toggleBookmark(this, 'post_0002')">üîñ</button>
        </div>
    </section>

    <section class="post-card" id="post_0003" data-type="image" data-url="https://example.com/posts/0003">
        <div class="post-header">
            <div class="avatar"></div>
            <div>
                <div class="username">Visual Data</div>
                <div class="timestamp">5 hrs ago ¬∑ Photo</div>
            </div>
        </div>
        <div class="post-content">
            <div class="placeholder-image" onclick="trackEmbedImage('post_0003')"></div>
        </div>
        <div class="post-footer">
            <div>Tap image to log embed-image clicks.</div>
        </div>
        <div class="action-rail">
            <button class="btn" onclick="toggleLike(this, 'post_0003')">‚ô°</button>
            <button class="btn" onclick="trackComment('post_0003')">üí¨</button>
            <button class="btn" onclick="trackRepost('post_0003')">üîÅ</button>
            <button class="btn" onclick="toggleBookmark(this, 'post_0003')">üîñ</button>
        </div>
    </section>

    <section class="post-card" id="post_0004" data-type="video" data-url="https://example.com/posts/0004">
        <div class="post-header">
            <div class="avatar"></div>
            <div>
                <div class="username">Creator Lab</div>
                <div class="timestamp">Yesterday ¬∑ Video</div>
            </div>
        </div>
        <div class="post-content">
            <div class="placeholder-video" onclick="toggleVideo(this, 'post_0004')">‚ñ∂ Tap to play demo video</div>
        </div>
        <div class="post-footer">
            <div>Video tracking: watch time + watch count.</div>
            <a class="link-tag" href="https://example.com/posts/0004" onclick="trackEmbedLink('post_0004')">
                üîó example.com/posts/0004
            </a>
        </div>
        <div class="action-rail">
            <button class="btn" onclick="toggleLike(this, 'post_0004')">‚ô°</button>
            <button class="btn" onclick="trackComment('post_0004')">üí¨</button>
            <button class="btn" onclick="trackRepost('post_0004')">üîÅ</button>
            <button class="btn" onclick="toggleBookmark(this, 'post_0004')">üîñ</button>
        </div>
    </section>
</div>

<div id="debug-console">
    <strong>DATA LOG (Show this to developers):</strong><br>
    --- awaiting interaction ---<br>
</div>

<script>
    const userActions = {
        posts: {}
    };

    function getPostState(postId) {
        if (!userActions.posts[postId]) {
            const postElement = document.getElementById(postId);
            userActions.posts[postId] = {
                post_id: postId,
                post_url: postElement.dataset.url,
                event_time_utc: null,
                dwell_time_ms: 0,
                liked: false,
                commented: false,
                comment_text: null,
                reposted: false,
                bookmarked: false,
                clicked_embed_link: false,
                clicked_embed_image: false,
                video_watch_time_ms: 0,
                video_watch_count: 0,
                videoPlaying: false,
                videoStart: null
            };
        }
        return userActions.posts[postId];
    }

    function logEvent(message, postId) {
        const consoleDiv = document.getElementById('debug-console');
        const time = new Date().toLocaleTimeString();
        consoleDiv.innerHTML += `[${time}] ${message}<br>`;
        if (postId) {
            const snapshot = JSON.stringify(getPostState(postId), null, 2);
            consoleDiv.innerHTML += `<pre>${snapshot}</pre>`;
        }
        consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }

    function updateEventTime(postId) {
        const state = getPostState(postId);
        state.event_time_utc = new Date().toISOString();
    }

    function toggleLike(btn, postId) {
        const state = getPostState(postId);
        btn.classList.toggle('liked');
        state.liked = btn.classList.contains('liked');
        updateEventTime(postId);
        logEvent(`ACTION: ${state.liked ? 'LIKED' : 'UNLIKED'} ${postId}`, postId);
    }

    function trackComment(postId) {
        const state = getPostState(postId);
        state.commented = true;
        state.comment_text = state.comment_text || "Sample comment";
        updateEventTime(postId);
        logEvent(`ACTION: COMMENTED on ${postId}`, postId);
    }

    function trackRepost(postId) {
        const state = getPostState(postId);
        state.reposted = true;
        updateEventTime(postId);
        logEvent(`ACTION: REPOSTED ${postId}`, postId);
    }

    function toggleBookmark(btn, postId) {
        const state = getPostState(postId);
        state.bookmarked = !state.bookmarked;
        btn.classList.toggle('liked');
        updateEventTime(postId);
        logEvent(`ACTION: ${state.bookmarked ? 'BOOKMARKED' : 'UNBOOKMARKED'} ${postId}`, postId);
    }

    function trackEmbedLink(postId) {
        const state = getPostState(postId);
        state.clicked_embed_link = true;
        updateEventTime(postId);
        logEvent(`ACTION: CLICKED EMBED LINK on ${postId}`, postId);
    }

    function trackEmbedImage(postId) {
        const state = getPostState(postId);
        state.clicked_embed_image = true;
        updateEventTime(postId);
        logEvent(`ACTION: CLICKED EMBED IMAGE on ${postId}`, postId);
    }

    function finalizeVideoWatch(postId) {
        const state = getPostState(postId);
        if (state.videoPlaying && state.videoStart) {
            state.video_watch_time_ms += Date.now() - state.videoStart;
            state.videoPlaying = false;
            state.videoStart = null;
        }
    }

    function toggleVideo(element, postId) {
        const state = getPostState(postId);
        if (!state.videoPlaying) {
            state.videoPlaying = true;
            state.videoStart = Date.now();
            state.video_watch_count += 1;
            element.textContent = '‚è∏ Playing... Tap to pause';
            element.style.backgroundColor = '#222';
            updateEventTime(postId);
            logEvent(`VIDEO: PLAY ${postId}`, postId);
        } else {
            finalizeVideoWatch(postId);
            element.textContent = '‚ñ∂ Tap to play demo video';
            element.style.backgroundColor = '#000';
            updateEventTime(postId);
            logEvent(`VIDEO: PAUSE ${postId}`, postId);
        }
    }

    const observerOptions = {
        threshold: 0.6
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            const postId = entry.target.id;
            const state = getPostState(postId);
            if (entry.isIntersecting) {
                entry.target.setAttribute('data-entry-time', Date.now());
                logEvent(`VIEW: ${postId} entered viewport`, postId);
            } else {
                const startTime = entry.target.getAttribute('data-entry-time');
                if (startTime) {
                    const duration = Date.now() - Number(startTime);
                    state.dwell_time_ms += duration;
                    finalizeVideoWatch(postId);
                    updateEventTime(postId);
                    logEvent(`VIEW: ${postId} left viewport. DWELL +${duration}ms`, postId);
                }
            }
        });
    }, observerOptions);

    document.querySelectorAll('.post-card').forEach(post => {
        observer.observe(post);
    });
</script>
</body>
</html>
